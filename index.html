<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whac a Mogg - Bonk Edition</title>
    <style>
        /* --- BACKGROUND & GLOBAL --- */
        /* FIXED: Changed bg3.png to bg2.png to match your GitHub repo */
        body { font-family: 'Arial Black', Gadget, sans-serif; text-align: center; background: #121212; background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url("bg2.png"); background-size: cover; background-attachment: fixed; color: white; margin: 0; overflow: hidden; }

        /* FIXED: Lowered z-index to -1 so it stays behind UI and buttons */
        #menu-video { position: fixed; inset: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: -1; pointer-events: none; }

        /* --- ANIMATIONS --- */
        .hammer-animation { position: absolute; width: 140px; height: 140px; background-size: contain; background-repeat: no-repeat; background-position: center; z-index: 50; pointer-events: none; top: -25%; left: 50%; transform: translate(-50%, 0) rotate(0deg); animation: hammerBonk 0.5s ease-out forwards; }       
        @keyframes hammerBonk { 0% { transform: translate(-50%, -20px) rotate(45deg); opacity: 0; } 50% { transform: translate(-50%, 0px) rotate(0deg); opacity: 1; } 100% { transform: translate(-50%, 20px) rotate(-20deg); opacity: 0; } }

        .miss-text { position: absolute; color: gold; font-size: 1.5rem; font-weight: bold; text-shadow: 2px 2px 0 #000; pointer-events: none; z-index: 60; top: 20%; left: 50%; transform: translate(-50%, 0); animation: floatUp 0.5s ease-out forwards; }
        @keyframes floatUp { 0% { transform: translate(-50%, 0); opacity: 1; } 100% { transform: translate(-50%, -30px); opacity: 0; } }

        #damage-overlay { position: fixed; inset: 0; background-color: red; opacity: 0; pointer-events: none; z-index: 999; }
        .flash-red { animation: damageFlash 0.4s ease-out forwards; }
        @keyframes damageFlash { 0% { opacity: 0; } 20% { opacity: 0.6; } 100% { opacity: 0; } }

        /* --- UI OVERLAYS --- */
        #login-screen, #loading-screen, #game-over-screen, #shop-screen, #leaderboard-screen, #pause-screen, #achievements-screen { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.75); z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: blur(5px); display: none; }

        .btn { background: #8de21d; color: #000; padding: 15px 40px; font-size: 1.5rem; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; margin: 5px; box-shadow: 0 5px 0 #5c990f; transition: all 0.1s; }
        .btn:active { transform: translateY(5px); box-shadow: 0 0 0 #5c990f; }
        .btn-shop { background: #ffcc00; box-shadow: 0 5px 0 #b38f00; }
        .btn-menu { background: #555; color: white; box-shadow: 0 5px 0 #333; }
        
        .game-header { display: flex; justify-content: space-between; align-items: center; width: 90vw; max-width: 450px; margin: 15px auto; gap: 15px; }
        .stats { padding: 12px 20px; font-size: 1.2rem; text-shadow: 2px 2px 0 #000; color: gold; background: rgba(45, 34, 28, 0.85); border: 4px solid #ffcc00; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); line-height: 1.4; text-align: left; flex-grow: 1; }

        /* --- GAME BOARD --- */
        /* FIXED: Changed soil.png to soil3.png and pipe.png to pipe3.png */
        #board { display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 10px; width: 90vw; max-width: 450px; aspect-ratio: 1/1; margin: 0 auto; background: url("soil3.png") center/cover; border: 8px solid #3d2b1f; border-radius: 15px; padding: 10px; }
        .tile { background: url("pipe3.png") no-repeat center bottom; background-size: 85%; position: relative; cursor: pointer; }

        .character-mask { position: absolute; width: 90%; height: 95%; bottom: 40%; left: 5%; overflow: hidden; display: flex; align-items: flex-end; justify-content: center; }
        .character-mask img { width: auto; height: auto; max-width: 100%; max-height: 100%; transform: translateY(100%); animation: slideUp 0.2s ease-out forwards; }
        .character-mask img.hide { animation: slideDown 0.15s ease-in forwards !important; }

        @keyframes slideUp { 0% { transform: translateY(100%); } 100% { transform: translateY(0); } }
        @keyframes slideDown { 0% { transform: translateY(0); } 100% { transform: translateY(100%); } }

        .toolbox, .leaderboard-box { background: rgba(74, 59, 50, 0.9); border: 8px solid #2d221c; border-radius: 15px; padding: 25px; display: flex; flex-direction: column; gap: 10px; width: 340px; max-height: 60vh; overflow-y: auto; margin: 20px 0; }
        .tool-slot { background: #1a1a1a; border: 3px dashed #555; border-radius: 12px; padding: 15px; width: 120px; display: flex; flex-direction: column; align-items: center; }
        .tool-slot img { width: 70px; height: 70px; object-fit: contain; }

        .shake { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
    </style>
</head>
<body>

    <video id="menu-video" autoplay loop muted playsinline>
        <source src="Video3.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <div id="damage-overlay"></div>
    <div id="toast-container"></div>

    <div id="login-screen" style="display: flex;">
        <h1 style="color: #8de21d; font-size: 3.5rem; text-shadow: 3px 3px 0 #000;">MOGG HUB</h1>
        <button class="btn" onclick="playAnonymous()">üé≠ PLAY AS GUEST</button>
    </div>

    <div id="loading-screen">
        <h1 style="color: #8de21d; font-size: 3rem; text-shadow: 3px 3px 0 #000;">BONK THE MOGG</h1>
        <div id="coin-display" style="color: gold; margin: 15px 0; font-size: 2rem; font-weight: bold;">0 üçå</div>
        <button class="btn" onclick="startGame()">‚ñ∂Ô∏è START</button>
        <button class="btn btn-menu" onclick="showLeaderboard()">üåç SCORES</button>
    </div>

    <div id="game-over-screen">
        <h1 style="color: #ff4757; font-size: 3rem;">GAME OVER</h1>
        <h2 id="final-score" style="color: gold; font-size: 4.5rem;">0 üçå</h2>
        <button class="btn" onclick="startGame()">‚Üª REPLAY</button>
        <button class="btn btn-menu" onclick="backToMenu()">üè† MENU</button>
    </div>

    <div id="game-area" style="display:none">
        <div class="game-header">
            <div class="stats">SCORE: <span id="score">0</span> üçå | LVL: <span id="lvl">1</span></div>
            <button class="btn" style="padding: 10px 20px; font-size: 1rem;" onclick="pauseGame()">‚è∏Ô∏è</button>
        </div>
        <div id="board"></div>
    </div>

    <audio id="sfx-hit" src="slap-sound-effect-funny-memes (1).mp3"></audio>
    <audio id="sfx-miss" src="woosh.mp3"></audio>
    <audio id="sfx-over" src="game-over-arcade-6435.mp3"></audio>
    <audio id="bg-music" src="15_wWt0p9a.mp3" loop></audio>

    <script>
        const API_URL = "https://3c0ec92d-e077-4fa4-838f-a515947180c4-00-f6iqiilr2eki.sisko.replit.dev/api";
        const ASSETS = { MOGG: "mogg3.gif", CACTUS: "mole1.gif", BONUS: "bonus3.gif" };
        
        let score = 0, level = 1, isOver = false, coins = 0;
        let currentUser = localStorage.getItem("moggUsername");
        let gameTimer;

        // Force Video Play on Interaction (GitHub Fix)
        document.body.addEventListener('click', () => {
            const v = document.getElementById('menu-video');
            if (v.paused) v.play();
        }, { once: true });

        function checkLogin() {
            if (currentUser) {
                document.getElementById("login-screen").style.display = "none";
                document.getElementById("loading-screen").style.display = "flex";
            }
        }

        function playAnonymous() {
            currentUser = "Guest_" + Math.floor(Math.random() * 9999);
            checkLogin();
        }

        function startGame() {
            score = 0; level = 1; isOver = false;
            document.getElementById("score").innerText = "0";
            document.getElementById("loading-screen").style.display = "none";
            document.getElementById("game-over-screen").style.display = "none";
            document.getElementById("game-area").style.display = "block";
            document.getElementById("bg-music").play().catch(()=>{});
            createBoard(); gameLoop();
        }

        function createBoard() {
            const b = document.getElementById("board"); b.innerHTML = "";
            for(let i=0; i<9; i++) {
                let t = document.createElement("div");
                t.className = "tile"; t.onmousedown = () => handleHit(i);
                let m = document.createElement("div");
                m.className = "character-mask"; m.id = "m" + i;
                m.dataset.type = "empty";
                t.appendChild(m); b.appendChild(t);
            }
        }

        function gameLoop() {
            if(isOver) return;
            spawnSingleEntity();
            gameTimer = setTimeout(gameLoop, Math.max(300, 800 - (level * 20)));
        }

        function spawnSingleEntity() {
            let emptySpots = [];
            for(let i=0; i<9; i++) {
                let m = document.getElementById("m" + i);
                if(m.dataset.type === "empty") emptySpots.push(i);
            }
            if(emptySpots.length === 0) return;
            let pos = emptySpots[Math.floor(Math.random() * emptySpots.length)];
            let mask = document.getElementById("m" + pos);
            let type = Math.random() < 0.2 ? "cactus" : "mogg";
            
            let img = document.createElement("img");
            img.src = type === "cactus" ? ASSETS.CACTUS : ASSETS.MOGG;
            mask.dataset.type = type; mask.appendChild(img);

            setTimeout(() => {
                if(!isOver && mask.dataset.type === type) {
                    img.classList.add("hide");
                    setTimeout(() => { img.remove(); mask.dataset.type = "empty"; }, 150);
                }
            }, 1000 - (level * 50));
        }

        function handleHit(id) {
            if(isOver) return;
            const mask = document.getElementById("m" + id);
            const type = mask.dataset.type;

            if(type === "mogg") {
                score++;
                document.getElementById("score").innerText = score;
                document.getElementById("sfx-hit").play();
                mask.querySelector("img").remove();
                mask.dataset.type = "empty";
                level = Math.floor(score / 10) + 1;
                document.getElementById("lvl").innerText = level;
            } else if(type === "cactus") {
                endGame();
            }
        }

        function endGame() {
            isOver = true; clearTimeout(gameTimer);
            document.getElementById("sfx-over").play();
            document.getElementById("bg-music").pause();
            document.getElementById("final-score").innerText = score + " üçå";
            document.getElementById("game-area").style.display = "none";
            document.getElementById("game-over-screen").style.display = "flex";
        }

        function backToMenu() {
            document.getElementById("game-over-screen").style.display = "none";
            document.getElementById("loading-screen").style.display = "flex";
        }

        window.onload = checkLogin;
    </script>
</body>
</html>
